(this["webpackJsonpreact-mesto-auth"]=this["webpackJsonpreact-mesto-auth"]||[]).push([[0],{20:function(e){e.exports=JSON.parse('{"a":"Art Ginzburg","b":{"type":"git","url":"git+https://github.com/artginzburg/react-mesto-auth.git"}}')},33:function(e,t,n){},44:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),r=n(17),o=n.n(r),i=n(9),s=(n(33),n(14)),l=n.n(s),u=n(2),d=n(23),b=n(19),j=n(3),m=n(4),h="nomoreparties.co",f="/login",p="/register",O="/",_={title:"\u0412\u0445\u043e\u0434",action:"\u0412\u043e\u0439\u0442\u0438"},v={title:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",action:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"},g={action:"\u0412\u044b\u0439\u0442\u0438"};function x(e,t){var n=Object(a.useState)(localStorage[e]?JSON.parse(localStorage[e]):t),c=Object(j.a)(n,2),r=c[0],o=c[1],i=Object(a.useCallback)((function(n){n.key===e&&o(n.newValue?JSON.parse(n.newValue):t)}),[e,t]),s=Object(a.useCallback)((function(t){localStorage[e]=JSON.stringify(t),o(t)}),[e]);return Object(a.useEffect)((function(){var e,t=["storage",i];return(e=window).addEventListener.apply(e,t),function(){var e;(e=window).removeEventListener.apply(e,t)}}),[i]),[r,s]}var C=n(11),k=n(12),S=n(22),N=n(21),y=function(){function e(t){Object(C.a)(this,e),this._handleFetch=function(e){return e.ok?e.json():Promise.reject(e.status)},this._baseUrl=t.baseUrl,this._headers=t.headers,this._authFormat=""}return Object(k.a)(e,[{key:"_constructAuthorization",value:function(){this._headers=Object(u.a)(Object(u.a)({},this._headers),{},{authorization:this._authFormat+localStorage.token})}},{key:"_customFetch",value:function(e,t,n){var a,c={headers:null!==(a=this._headers)&&void 0!==a?a:{}};return t&&"GET"!==t&&(c.method=t,"DELETE"!==t&&(c.headers["Content-Type"]="application/json")),n&&(c.body=JSON.stringify(n)),fetch("".concat(this._baseUrl,"/").concat(e),c).then(this._handleFetch)}}]),e}(),E={url:new URL("https://mesto.".concat(h)),version:"v1",endpoints:{users:"users/me",cards:"cards"}},w=new(function(e){Object(S.a)(n,e);var t=Object(N.a)(n);function n(){var e;Object(C.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).editProfile=function(t){var n=t.name,a=t.about;return e._customFetch(E.endpoints.users,"PATCH",{name:n,about:a})},e.addCard=function(t,n){return e._customFetch(E.endpoints.cards,"POST",{name:t,link:n})},e.deleteCard=function(t){return e._customFetch("".concat(E.endpoints.cards,"/").concat(t),"DELETE")},e.changeLikeCardStatus=function(t,n){return e._customFetch("".concat(E.endpoints.cards,"/likes/").concat(t),n?"PUT":"DELETE")},e.updateAvatar=function(t){var n=t.avatar;return e._customFetch("".concat(E.endpoints.users,"/avatar"),"PATCH",{avatar:n})},e}return Object(k.a)(n,[{key:"getUserInfo",value:function(){return this._customFetch(E.endpoints.users)}},{key:"getInitialCards",value:function(){return this._customFetch(E.endpoints.cards)}}]),n}(y))({baseUrl:"".concat(E.url.origin,"/").concat(E.version,"/").concat("cohort-24"),headers:{authorization:"70313b07-c3c0-40aa-a296-04d0e6bc7885"}}),L={url:new URL("https://auth.".concat(h)),endpoints:{signup:"signup",signin:"signin",user:"users/me"}},T=new(function(e){Object(S.a)(n,e);var t=Object(N.a)(n);function n(e){var a;return Object(C.a)(this,n),(a=t.call(this,e))._authFormat="Bearer ",a}return Object(k.a)(n,[{key:"register",value:function(e,t){return this._customFetch(L.endpoints.signup,"POST",{password:t,email:e})}},{key:"login",value:function(e,t){return this._customFetch(L.endpoints.signin,"POST",{password:t,email:e})}},{key:"getUserInfo",value:function(){return this._constructAuthorization(),this._customFetch(L.endpoints.user).then((function(e){return e.data}))}}]),n}(y))({baseUrl:L.url.origin}),F=n(0),I={name:"\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0439",about:"\u041f\u043e\u0442\u0435\u0440\u044f\u043d\u043e \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c"},U=c.a.createContext(),A=c.a.createContext();function P(e){var t=e.state,n=e.dispatch,a=e.children;return Object(F.jsx)(U.Provider,{value:t,children:Object(F.jsx)(A.Provider,{value:n,children:a})})}function R(){var e=c.a.useContext(U);if(void 0===e)throw new Error("useCurrentUser must be used within a CurrentUserProvider");return e}function D(){var e=c.a.useContext(A);if(void 0===e)throw new Error("useCurrentUserDispatcher must be used within a CurrentUserProvider");return e}function B(e,t){return JSON.stringify(e)===JSON.stringify(t)}function J(e,t,n,a){return q.apply(this,arguments)}function q(){return(q=Object(b.a)(l.a.mark((function e(t,n,a,c){var r,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(u.a)(Object(u.a)({},n),a),t(r),e.prev=2,e.next=5,w[c](a);case 5:o=e.sent,B(r,o)||t(o),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),t(n),console.log("Couldnt update user information on the server",e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}var z=function(e){return".".concat(e)},V="popup__close-button",H="form",M="form__input",G="form__input_type_error",Y="form__error_visible",K="form__button",Q={formSelector:z(H),inputSelector:z(M),submitButtonSelector:z(K),inputErrorClass:G,errorClass:Y},W=n(13),X=["onSubmit"],Z=Object(a.memo)((function(e){var t=e.onSubmit,n=Object(W.a)(e,X),c=Object(a.useCallback)((function(e){t&&(e.preventDefault(),t(e))}),[t]);return Object(F.jsx)("form",Object(u.a)(Object(u.a)({action:"#",onSubmit:c},n),{},{children:e.children}))})),$=["isFocused"],ee="text",te=!0,ne=2,ae=Object(a.forwardRef)((function(e,t){var n,c,r,o=null!==t&&void 0!==t?t:Object(a.createRef)(),i=null!==(n=e.type)&&void 0!==n?n:ee,s=null!==(c=e.required)&&void 0!==c?c:te,l=i===ee?ne:null,d={type:i,minLength:null!==(r=e.minLength)&&void 0!==r?r:l,required:s,ref:o},b=e.isFocused,j=Object(W.a)(e,$);return Object(a.useEffect)((function(){b&&o&&o.current&&o.current.parentElement!==document.activeElement.parentElement&&setTimeout((function(){o&&o.current&&o.current.focus()}),50)}),[b,o]),Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)("input",Object(u.a)(Object(u.a)({},j),{},{className:"".concat(M).concat(j.className?" ".concat(j.className):"")},d)),Object(F.jsx)("p",{className:"form__error",id:"".concat(e.id,"-error")})]})})),ce={autoCorrect:"off",spellCheck:!1,className:"".concat(M,"_theme_dark")},re="email",oe="password",ie=Object(a.memo)((function(e){var t=Object(j.a)(e.states.email,2),n=t[0],a=t[1],c=Object(j.a)(e.states.password,2),r=c[0],o=c[1];return Object(F.jsxs)("div",{className:"auth",children:[Object(F.jsx)("h2",{className:"auth__title",children:e.title}),Object(F.jsxs)(Z,{onSubmit:function(t){e.handleSubmit(t,n,r)},onReset:function(){a(""),o("")},className:H,children:[Object(F.jsx)(ae,Object(u.a)(Object(u.a)({},ce),{},{autoFocus:!0,id:re,name:re,type:re,placeholder:"Email",autoComplete:re,value:n,onChange:function(e){a(e.target.value)}})),Object(F.jsx)(ae,Object(u.a)(Object(u.a)({},ce),{},{id:e.passwordAutocomplete,name:oe,type:oe,placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",autoComplete:e.passwordAutocomplete,value:r,onChange:function(e){o(e.target.value)}})),Object(F.jsx)("button",{type:"submit",className:"auth__button ".concat(K," ").concat(K,"_theme_dark"),children:e.buttonTitle})]}),e.children]})})),se={passwordAutocomplete:"current-password",title:_.title,buttonTitle:_.action},le=Object(a.memo)((function(e){return Object(F.jsx)(ie,Object(u.a)(Object(u.a)({handleSubmit:e.handleLogin},e),se))})),ue={passwordAutocomplete:"new-password",title:v.title,buttonTitle:v.action},de=Object(a.memo)((function(e){return Object(F.jsx)(ie,Object(u.a)(Object(u.a)(Object(u.a)({handleSubmit:e.handleRegister},e),ue),{},{children:Object(F.jsxs)("div",{className:"auth__signin",children:["\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b?"," ",Object(F.jsx)(i.b,{to:f,className:"auth__login-link",children:_.action})]})}))})),be=Object(a.memo)((function(e){var t,n,c={email:Object(a.useState)(null!==(n="email",t=localStorage[n]&&atob(JSON.parse(localStorage[n])))&&void 0!==t?t:""),password:Object(a.useState)("")};return e.loggedIn?Object(F.jsx)(m.a,{to:O}):Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(m.b,{path:f,children:Object(F.jsx)(le,{handleLogin:e.handleLogin,states:c})}),Object(F.jsx)(m.b,{path:p,children:Object(F.jsx)(de,{handleRegister:e.handleRegister,states:c})})]})})),je=function(e){return Object(F.jsx)(m.b,{children:e.loggedIn?e.children:Object(F.jsx)(m.a,{to:f})})},me=n(20),he=me.b.url.split(".");he.pop();for(var fe=he.join(".").split("+")[1],pe=n.p+"static/media/logo.6fa47d29.svg",Oe=Object(a.memo)((function(e){var t,n=Object(m.g)(),a=Object(m.h)(),c=Object(j.a)(e.loggedIn,2),r=c[0],o=c[1],s=f;switch(a.pathname){case f:t=v.title,s=p;break;case p:t=_.action;break;default:t=g.action}return Object(F.jsxs)("header",{className:"header",children:[Object(F.jsx)("a",{target:"_self",href:fe,className:"logo header__logo",children:Object(F.jsx)("img",{className:"logo__img",alt:"Mesto",src:pe})}),Object(F.jsxs)("div",{className:"header__container",children:[r&&e.credential?Object(F.jsx)("p",{className:"header__credential",children:e.credential}):null,Object(F.jsx)(i.b,{to:s,onClick:r?function(){delete localStorage.token,o(!1),n.replace(f)}:null,className:"header__action-button".concat(r?" header__action-button_dimmed":""),children:t})]})]})})),_e="element__trash-button",ve="element__like-button",ge=Object(a.memo)((function(e){var t,n=e.card;n.likes=null!==(t=n.likes)&&void 0!==t?t:[];var a=R();n.isTemporarilyLocal&&(n.owner=a);var c=[_e];if(n.owner._id===a._id){var r="".concat(_e,"_visible");c.push(r)}var o=c.join(" "),i=[ve];if(n.likes.some((function(e){return e._id===a._id}))){var s="".concat(ve,"_active");i.push(s)}var l=i.join(" ");return Object(F.jsxs)("li",{className:"element",children:[Object(F.jsx)("img",{onClick:function(){e.onCardClick(n)},className:"element__image",alt:n.name,src:n.link}),Object(F.jsx)("button",{onClick:function(){n.isTemporarilyLocal||e.onCardDelete(n)},type:"reset",className:o}),Object(F.jsxs)("div",{className:"element__container",children:[Object(F.jsx)("h2",{className:"element__title",children:n.name}),Object(F.jsxs)("div",{className:"element__likes",children:[Object(F.jsx)("button",{onClick:function(){n.isTemporarilyLocal||e.onCardLike(n)},type:"button",className:l}),Object(F.jsx)("p",{className:"element__like-counter",children:n.likes.length})]})]})]})})),xe={isTemporarilyLocal:!0,name:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."},Ce=[],ke=0;ke<30;ke++)Ce.push(xe);var Se=Object(a.memo)((function(e){var t=R(),n=Object(a.useMemo)((function(){return e.cards.length?e.cards:Ce}),[e.cards]);return Object(F.jsxs)("main",{className:"content",children:[Object(F.jsxs)("section",{className:"profile",children:[Object(F.jsx)("button",{onClick:e.onEditAvatar,type:"button",className:"profile__avatar-container",children:Object(F.jsx)("img",{alt:"\u0410\u0432\u0430\u0442\u0430\u0440",className:"profile__avatar",src:t.avatar})}),Object(F.jsxs)("div",{className:"profile__info",children:[Object(F.jsx)("h1",{className:"profile__name",children:t.name}),Object(F.jsx)("p",{className:"profile__description",children:t.about}),Object(F.jsx)("button",{onClick:e.onEditProfile,type:"button",className:"profile__edit-button"})]}),Object(F.jsx)("button",{onClick:e.onAddPlace,type:"button",className:"profile__add-button"})]}),Object(F.jsx)("section",{className:"elements",children:Object(F.jsx)("ul",{className:"elements__list",children:n.map((function(t){var n;return Object(F.jsx)(ge,{onCardClick:e.onCardClick,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete,card:t},null!==(n=t._id)&&void 0!==n?n:Math.random())}))})})]})})),Ne=fe.split("/");Ne.pop();var ye=Ne.join("/"),Ee=(new Date).getFullYear(),we=Object(a.memo)((function(){return Object(F.jsx)("footer",{className:"footer",children:Object(F.jsxs)("a",{target:"_blank",rel:"noreferrer",href:ye,className:"footer__copyright",children:["\xa9 ",Ee," ",me.a]})})})),Le=function(){function e(t,n){var a=this;Object(C.a)(this,e),this._showInputError=function(e,t){var n=a._element.querySelector("#".concat(e.id,"-error"));e.classList.add(a._data.inputErrorClass),n.textContent=t,n.classList.add(a._data.errorClass)},this._hideInputError=function(e){var t=a._element.querySelector("#".concat(e.id,"-error"));e.classList.remove(a._data.inputErrorClass),t.classList.remove(a._data.errorClass),t.textContent=""},this._resetFormErrors=function(){a._inputList.forEach((function(e){return a._hideInputError(e)})),a._toggleButtonState(1)},this._checkInputValidity=function(e){return e.validity.valid?a._hideInputError(e):a._showInputError(e,e.validationMessage)},this._hasInvalidInput=function(e){return e.some((function(e){return!e.validity.valid}))},this._toggleButtonState=function(e){return a._buttonElement.disabled=e||a._hasInvalidInput(a._inputList)},this._validationHandler=function(e){a._checkInputValidity(e),a._toggleButtonState()},this._setListeners=function(){a._element.addEventListener("reset",a._resetFormErrors),a._inputList.forEach((function(e){e.value&&a._validationHandler(e),e.addEventListener("input",(function(){return a._validationHandler(e)}))}))},this._data=t,this._element=n,this._inputList=Array.from(this._element.querySelectorAll(this._data.inputSelector)),this._buttonElement=this._element.querySelector(this._data.submitButtonSelector)}return Object(k.a)(e,[{key:"enableValidation",value:function(){this._toggleButtonState(),this._setListeners()}}]),e}();var Te={className:"popup",classNameClosed:"",isOpened:!1};Te.classNameOpened="".concat(Te.className,"_opened");var Fe=document.getElementById("modal-root"),Ie=Object(a.memo)((function(e){var t=Object(a.useState)(Te.classNameClosed),n=Object(j.a)(t,2),c=n[0],o=n[1],i=Object(a.useState)(Te.isOpened),s=Object(j.a)(i,2),l=s[0],u=s[1];if(Object(a.useEffect)((function(){if(e.isOpen||document.activeElement.blur(),e.isOpen){u(!Te.isOpened);var t=setTimeout((function(){o(Te.classNameOpened)}),10);return function(){return clearTimeout(t)}}o(Te.classNameClosed);var n=setTimeout((function(){u(Te.isOpened)}),300);return function(){return clearTimeout(n)}}),[e.isOpen]),!l)return null;var d=[Te.className,e.className,c].filter((function(e){return null!=e&&""!==e})).join(" ");return Object(r.createPortal)(Object(F.jsx)("section",{onClick:e.onClick,className:d,id:e.id,children:e.children}),Fe)})),Ue=["onSubmit","children"],Ae=Object(a.memo)((function(e){var t,n=e,c=n.onSubmit,r=n.children,o=Object(W.a)(n,Ue),i=null!==(t=(e=o).buttonTitle)&&void 0!==t?t:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",s=Object(a.useCallback)((function(e){c&&c(e),r&&e.target.reset()}),[r,c]),l=e.name;return Object(a.useEffect)((function(){if(e.isOpen){var t=setTimeout((function(){var e;e=document.getElementById(l).querySelector(Q.formSelector),new Le(Q,e).enableValidation()}),1);return function(){return clearTimeout(t)}}}),[l,e.isOpen]),Object(F.jsx)(Ie,{isOpen:e.isOpen,onClick:e.onClose,id:l,children:Object(F.jsxs)("div",{className:"popup__container",children:[Object(F.jsx)("button",{type:"reset",className:V}),Object(F.jsx)("h2",{className:"popup__title",children:e.title}),Object(F.jsxs)(Z,{className:H,onSubmit:s,onReset:e.onReset,children:[r,Object(F.jsx)("button",{type:"submit",className:"popup__button ".concat(K),children:i})]})]})})})),Pe=Object(a.memo)((function(e){var t=Object(a.useState)(""),n=Object(j.a)(t,2),c=n[0],r=n[1],o=Object(a.useState)(""),i=Object(j.a)(o,2),s=i[0],l=i[1],d=R(),b=D();return Object(a.useEffect)((function(){r(d.name),l(d.about)}),[d]),Object(F.jsxs)(Ae,Object(u.a)(Object(u.a)({},e),{},{onSubmit:function(){J(b,d,{name:c,about:s},"editProfile"),e.onUpdateUser()},title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",name:"profile-editor",children:[Object(F.jsx)(ae,{isFocused:e.isOpen,value:c,onChange:function(e){r(e.target.value)},autoComplete:"name",autoCapitalize:"words",name:"name",id:"profile-name",placeholder:"\u0418\u043c\u044f",maxLength:"40"}),Object(F.jsx)(ae,{value:s,onChange:function(e){l(e.target.value)},name:"about",id:"profile-about",placeholder:"\u041e \u0441\u0435\u0431\u0435",maxLength:"200"})]}))})),Re=Object(a.memo)((function(e){var t=Object(a.useRef)(),n=R(),c=D();return Object(F.jsx)(Ae,Object(u.a)(Object(u.a)({},e),{},{onSubmit:function(){J(c,n,{avatar:t.current.value},"updateAvatar"),e.onUpdateAvatar()},title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",name:"avatar-editor",children:Object(F.jsx)(ae,{isFocused:e.isOpen,ref:t,type:"url",name:"avatar",id:"profile-avatar",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443"})}))})),De="",Be="",Je=Object(a.memo)((function(e){var t=Object(a.useState)(De),n=Object(j.a)(t,2),c=n[0],r=n[1],o=Object(a.useState)(Be),i=Object(j.a)(o,2),s=i[0],l=i[1];return Object(F.jsxs)(Ae,Object(u.a)(Object(u.a)({},e),{},{onSubmit:function(){e.onAddPlace(c,s)},onReset:function(){r(De),l(Be)},title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",name:"element-editor",buttonTitle:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c",children:[Object(F.jsx)(ae,{isFocused:e.isOpen,value:c,onChange:function(e){r(e.target.value)},name:"title",id:"element-title",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",maxLength:"30"}),Object(F.jsx)(ae,{value:s,onChange:function(e){l(e.target.value)},type:"url",name:"link",id:"element-link",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443"})]}))})),qe=Object(a.memo)((function(e){return Object(F.jsx)(Ae,Object(u.a)(Object(u.a)({},e),{},{onSubmit:function(){e.onCardDelete(e.card)},title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",name:"delete-confirmation",buttonTitle:"\u0414\u0430"}))})),ze=[V,"".concat(V,"_parent-corners_straight")].join(" "),Ve=Object(a.memo)((function(e){var t=e.card;return Object(F.jsx)(Ie,{isOpen:e.isOpen,onClick:e.onClose,className:"popup_type_image",id:"image-viewer",children:Object(F.jsxs)("figure",{className:"popup__figure",children:[Object(F.jsx)("button",{type:"button",className:ze}),Object(F.jsx)("img",{className:"popup__image",alt:t.name,src:t.link}),Object(F.jsx)("figcaption",{className:"popup__caption",children:t.name})]})})})),He=n.p+"static/media/check.5221857e.svg",Me=n.p+"static/media/cross.173b3897.svg",Ge=["isSuccess"],Ye=Object(a.memo)((function(e){var t,n=e.isSuccess,a=Object(W.a)(e,Ge);return Object(F.jsx)(Ie,{isOpen:a.isOpen,onClick:a.onClose,children:Object(F.jsxs)("div",{className:"popup__container",children:[Object(F.jsx)("button",{type:"button",className:V}),Object(F.jsxs)("div",{className:"info-tooltip",children:[Object(F.jsx)("div",{className:"info-tooltip__icon",style:(t=n?He:Me,{backgroundImage:"url(".concat(t,")")})}),Object(F.jsx)("h3",{className:"info-tooltip__title",children:n?"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!":"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437."})]})]})})}));var Ke=function(){var e=Object(m.g)(),t=x("currentUser",I),n=Object(j.a)(t,2),r=n[0],o=n[1],i=x("loggedIn",!1),s=Object(j.a)(i,2),h=s[0],_=s[1],v=function(e,t){var n=x(e,t),c=Object(j.a)(n,2),r=c[0],o=c[1],i=Object(a.useCallback)((function(e){o(btoa(e))}),[o]),s=Object(a.useRef)(atob(r));return Object(a.useEffect)((function(){s.current=atob(r)})),[s.current,i]}("email",""),g=Object(j.a)(v,2),C=g[0],k=g[1],S=c.a.useState(!1),N=Object(j.a)(S,2),y=N[0],E=N[1],L=c.a.useState(!1),U=Object(j.a)(L,2),A=U[0],R=U[1],D=c.a.useState(!1),B=Object(j.a)(D,2),J=B[0],q=B[1],z=c.a.useState(!1),V=Object(j.a)(z,2),H=V[0],M=V[1],G=c.a.useState(!1),Y=Object(j.a)(G,2),K=Y[0],Q=Y[1],W=c.a.useState(!1),X=Object(j.a)(W,2),Z=X[0],$=X[1],ee=c.a.useState(!1),te=Object(j.a)(ee,2),ne=te[0],ae=te[1],ce=c.a.useState({}),re=Object(j.a)(ce,2),oe=re[0],ie=re[1],se=x("cards",[]),le=Object(j.a)(se,2),ue=le[0],de=le[1];function me(){return(me=Object(b.a)(l.a.mark((function e(t){var n,a,c,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ue,a=t.likes.some((function(e){return e._id===r._id})),c=a?t.likes.filter((function(e){return e._id!==r._id})):[].concat(Object(d.a)(t.likes),[r]),o=Object(u.a)(Object(u.a)({},t),{},{likes:c}),de(ue.map((function(e){return e._id===t._id?o:e}))),e.prev=5,e.next=8,w.changeLikeCardStatus(t._id,!a);case 8:i=e.sent,de(ue.map((function(e){return e._id===t._id?i:e}))),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(5),de(n),console.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[5,12]])})))).apply(this,arguments)}function he(){q(!1),E(!1),R(!1),M(!1),Q(!1),$(!1)}c.a.useEffect((function(){w.getUserInfo().then(o).catch((function(e){return console.log("Couldnt get user info from the server",e)}))}),[o]),c.a.useEffect((function(){w.getInitialCards().then(de).catch((function(e){return console.log("Couldnt get initial cards from the server",e)}))}),[de]);var fe=c.a.useCallback((function(e){var t=ue;de(ue.filter((function(t){return t._id!==e._id}))),w.deleteCard(e._id).catch((function(e){de(t),console.log("Couldnt delete card on the server",e)})),he()}),[ue,de]),pe=c.a.useCallback((function(e){e.target===e.currentTarget&&he()}),[]),_e=he,ve=he;!function(e){var t=Object(a.useCallback)((function(t){"Escape"===t.key&&e()}),[e]);Object(a.useEffect)((function(){var e,n=["keydown",t,!1];return(e=document).addEventListener.apply(e,n),function(){var e;return(e=document).removeEventListener.apply(e,n)}}),[t])}(he);var ge=c.a.useCallback((function(e){k(e),_(!0)}),[k,_]),xe=c.a.useCallback((function(){localStorage.token&&(T.token=localStorage.token,T.getUserInfo().then((function(t){t&&(ge(t.email),e.replace(O))})).catch((function(e){_(!1),console.log(e)})))}),[ge,e,_]);return c.a.useEffect((function(){xe()}),[xe]),Object(F.jsxs)(P,{state:r,dispatch:o,children:[Object(F.jsx)(Oe,{credential:C,loggedIn:[h,_]}),Object(F.jsxs)(m.d,{children:[Object(F.jsxs)(m.b,{path:[p,f],children:[Object(F.jsx)(be,{loggedIn:h,handleLogin:function(t,n,a){n&&a&&T.login(n,a).then((function(a){a.token&&(t.target.reset(),localStorage.token=a.token,ge(n),e.push(O))})).catch((function(e){$(!0),console.log(e)}))},handleRegister:function(t,n,a){T.register(n,a).then((function(){e.replace(f),ae(!0)})).catch((function(e){ae(!1),console.log(e)})).finally((function(){$(!0)}))}}),Object(F.jsx)(Ye,{isOpen:Z,isSuccess:ne,onClose:pe})]}),Object(F.jsxs)(je,{path:O,loggedIn:h,children:[Object(F.jsx)(Se,{onEditProfile:function(){E(!0)},onAddPlace:function(){R(!0)},onEditAvatar:function(){q(!0)},cards:ue,onCardClick:function(e){ie(e),Q(!0)},onCardLike:function(e){return me.apply(this,arguments)},onCardDelete:function(e){ie(e),M(!0)}}),Object(F.jsx)(Pe,{onUpdateUser:_e,isOpen:y,onClose:pe}),Object(F.jsx)(Je,{onAddPlace:function(e,t){var n=ue;de([{isTemporarilyLocal:!0,name:e,link:t}].concat(Object(d.a)(ue))),w.addCard(e,t).then((function(e){return de([e].concat(Object(d.a)(ue)))})).catch((function(){return de(n)})),he()},isOpen:A,onClose:pe}),Object(F.jsx)(Re,{onUpdateAvatar:ve,isOpen:J,onClose:pe}),Object(F.jsx)(qe,{card:oe,onCardDelete:fe,isOpen:H,onClose:pe}),Object(F.jsx)(Ve,{card:oe,isOpen:K,onClose:pe})]})]}),Object(F.jsx)(we,{})]})},Qe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,45)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,o=t.getTTFB;n(e),a(e),c(e),r(e),o(e)}))};o.a.render(Object(F.jsx)(c.a.StrictMode,{children:Object(F.jsx)(i.a,{basename:"/react-mesto-auth",children:Object(F.jsx)(Ke,{})})}),document.getElementById("root")),Qe()}},[[44,1,2]]]);
//# sourceMappingURL=main.6c55fefa.chunk.js.map